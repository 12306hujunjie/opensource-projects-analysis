# Flask Blueprintå’Œæ‰©å±•æ€§ç³»ç»Ÿæ·±åº¦è§£æ

## ğŸ”— è“å›¾ç³»ç»Ÿçš„æ¨¡å—åŒ–æ¶æ„

Flaskçš„è“å›¾ç³»ç»Ÿæ˜¯å…¶æ¨¡å—åŒ–è®¾è®¡çš„æ ¸å¿ƒï¼Œé€šè¿‡ç²¾å¦™çš„å»¶è¿Ÿç»‘å®šæœºåˆ¶å®ç°äº†å¤§å‹åº”ç”¨çš„ç»„ç»‡å’Œç®¡ç†ã€‚

### Blueprintç±»çš„ç»§æ‰¿è®¾è®¡

**å¤šå±‚ç»§æ‰¿çš„æ¶æ„è®¾è®¡** (`flask/blueprints.py:18-49`)ï¼š

```python
class Blueprint(SansioBlueprint):
    def __init__(self, name: str, import_name: str, **kwargs):
        super().__init__(name, import_name, **kwargs)
        
        # CLIå‘½ä»¤ç»„é›†æˆ
        self.cli = AppGroup()
        self.cli.name = self.name  # è®¾ç½®Clickç»„åç§°
```

**SansioBlueprintçš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
```python
# SansioBlueprintæä¾›æ ¸å¿ƒçš„è“å›¾åŠŸèƒ½
class SansioBlueprint(Scaffold):
    """æ— I/Oæ“ä½œçš„è“å›¾åŸºç±»"""
    
    def __init__(self, name: str, import_name: str, 
                 static_folder=None, static_url_path=None,
                 template_folder=None, url_prefix=None,
                 subdomain=None, url_defaults=None, root_path=None):
        super().__init__(
            import_name=import_name,
            static_folder=static_folder,
            static_url_path=static_url_path,
            template_folder=template_folder,
            root_path=root_path,
        )
        self.name = name
        self.url_prefix = url_prefix
        self.subdomain = subdomain
        self.deferred_functions = []  # å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨
```

### è“å›¾æ³¨å†Œçš„å»¶è¿Ÿç»‘å®šæœºåˆ¶

#### 1. recordæœºåˆ¶çš„ç²¾å¦™è®¾è®¡

**å»¶è¿Ÿæ³¨å†Œçš„æ ¸å¿ƒ**ï¼š
```python
def record(self, func: t.Callable[[BlueprintSetupState], None]) -> None:
    """è®°å½•ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è“å›¾æ³¨å†Œæ—¶æ‰§è¡Œ"""
    if self._got_registered_once and self.warn_on_modifications:
        from warnings import warn
        warn(Warning(f"The blueprint {self.name} was already registered once"))
    self.deferred_functions.append(func)

def route(self, rule: str, **options: t.Any) -> t.Callable[[T_route], T_route]:
    """è“å›¾è·¯ç”±è£…é¥°å™¨"""
    def decorator(f: T_route) -> T_route:
        endpoint = options.get("endpoint")
        if endpoint is None:
            endpoint = f.__name__
        # å…³é”®ï¼šä½¿ç”¨recordå»¶è¿Ÿæ³¨å†Œ
        self.record(lambda s: s.add_url_rule(rule, endpoint, f, **options))
        return f
    return decorator
```

**ä¸ºä»€ä¹ˆéœ€è¦å»¶è¿Ÿç»‘å®šï¼Ÿ**
```python
# åˆ›å»ºè“å›¾æ—¶ï¼Œåº”ç”¨è¿˜ä¸å­˜åœ¨
blog_bp = Blueprint('blog', __name__)

@blog_bp.route('/posts')
def list_posts():
    return 'Posts list'

# æ­¤æ—¶è·¯ç”±è¿˜æ²¡æœ‰æ³¨å†Œåˆ°åº”ç”¨ï¼Œåªæ˜¯è®°å½•äº†æ³¨å†Œæ„å›¾
# ç›´åˆ°åº”ç”¨æ³¨å†Œè“å›¾æ—¶æ‰çœŸæ­£æ³¨å†Œè·¯ç”±

app = Flask(__name__)
app.register_blueprint(blog_bp)  # è¿™æ—¶æ‰æ‰§è¡ŒçœŸæ­£çš„è·¯ç”±æ³¨å†Œ
```

#### 2. BlueprintSetupStateçš„çŠ¶æ€ç®¡ç†

**æ³¨å†Œæ—¶çš„çŠ¶æ€å°è£…**ï¼š
```python
class BlueprintSetupState:
    """è“å›¾æ³¨å†Œæ—¶çš„çŠ¶æ€å¯¹è±¡"""
    
    def __init__(self, blueprint: Blueprint, app: Flask, options: t.Any, first_registration: bool):
        self.app = app
        self.blueprint = blueprint
        self.options = options
        self.first_registration = first_registration
        
        # å¤„ç†URLå‰ç¼€
        self.url_prefix = options.get("url_prefix")
        if self.url_prefix is None:
            self.url_prefix = self.blueprint.url_prefix
            
        # å¤„ç†å­åŸŸå
        self.subdomain = options.get("subdomain")
        if self.subdomain is None:
            self.subdomain = self.blueprint.subdomain
            
    def add_url_rule(self, rule: str, endpoint: str | None = None, 
                     view_func: t.Callable | None = None, **options):
        """è“å›¾çŠ¶æ€ä¸‹çš„URLè§„åˆ™æ·»åŠ """
        if self.url_prefix is not None:
            if rule:
                rule = "/".join((self.url_prefix.rstrip("/"), rule.lstrip("/")))
            else:
                rule = self.url_prefix
                
        options.setdefault("subdomain", self.subdomain)
        
        if endpoint is None:
            endpoint = _endpoint_from_view_func(view_func)
            
        defaults = self.blueprint.url_defaults
        if defaults:
            options.setdefault("defaults", defaults)
            
        # ç«¯ç‚¹åç§°æ·»åŠ è“å›¾å‰ç¼€
        if "." not in endpoint:
            endpoint = f"{self.blueprint.name}.{endpoint}"
            
        # æœ€ç»ˆæ³¨å†Œåˆ°åº”ç”¨
        self.app.add_url_rule(rule, endpoint, view_func, **options)
```

### è“å›¾çš„èµ„æºéš”ç¦»æœºåˆ¶

#### 1. é™æ€æ–‡ä»¶çš„å‘½åç©ºé—´å¤„ç†

**è“å›¾é™æ€æ–‡ä»¶å¤„ç†** (`flask/blueprints.py:82-102`)ï¼š
```python
def send_static_file(self, filename: str) -> Response:
    """å‘é€è“å›¾çš„é™æ€æ–‡ä»¶"""
    if not self.has_static_folder:
        raise RuntimeError("'static_folder' must be set to serve static_files.")

    # è·å–ç¼“å­˜æ§åˆ¶
    max_age = self.get_send_file_max_age(filename)
    return send_from_directory(
        t.cast(str, self.static_folder), filename, max_age=max_age
    )

@property
def has_static_folder(self) -> bool:
    """æ£€æŸ¥æ˜¯å¦æœ‰é™æ€æ–‡ä»¶å¤¹"""
    return self.static_folder is not None
```

**é™æ€æ–‡ä»¶URLçš„è‡ªåŠ¨æ³¨å†Œ**ï¼š
```python
def register_blueprint(self, blueprint: Blueprint, **options):
    """æ³¨å†Œè“å›¾åˆ°åº”ç”¨"""
    first_registration = False
    
    if blueprint.name in self.blueprints:
        existing_bp = self.blueprints[blueprint.name]
        if existing_bp is not self:
            raise AssertionError("A blueprint with that name is already registered.")
    else:
        self.blueprints[blueprint.name] = blueprint
        self._blueprint_order.append(blueprint)
        first_registration = True

    blueprint.register(self, options, first_registration)
    
    # è‡ªåŠ¨æ³¨å†Œé™æ€æ–‡ä»¶è·¯ç”±
    if blueprint.has_static_folder:
        state = BlueprintSetupState(blueprint, self, options, first_registration)
        self.add_url_rule(
            f"{blueprint.static_url_path}/<path:filename>",
            endpoint=f"{blueprint.name}.static",
            view_func=blueprint.send_static_file,
        )
```

#### 2. æ¨¡æ¿æ–‡ä»¶å¤¹çš„å±‚æ¬¡åŒ–åŠ è½½

**è“å›¾æ¨¡æ¿åŠ è½½å™¨**ï¼š
```python
@property
def jinja_loader(self) -> BaseLoader | None:
    """è“å›¾çš„Jinjaæ¨¡æ¿åŠ è½½å™¨"""
    if self.template_folder is not None:
        return FileSystemLoader(
            os.path.join(self.root_path, self.template_folder)
        )
    return None

def create_global_jinja_loader(self) -> BaseLoader:
    """åˆ›å»ºå…¨å±€æ¨¡æ¿åŠ è½½å™¨ï¼Œæ”¯æŒè“å›¾æ¨¡æ¿"""
    return ChoiceLoader([
        self.jinja_loader,  # åº”ç”¨æ¨¡æ¿ä¼˜å…ˆ
        PrefixLoader({
            name: blueprint.jinja_loader
            for name, blueprint in self.blueprints.items()
            if blueprint.jinja_loader is not None
        })  # è“å›¾æ¨¡æ¿
    ])
```

### è“å›¾çš„é’©å­å’Œä¸Šä¸‹æ–‡å¤„ç†

#### 1. è“å›¾çº§åˆ«çš„è¯·æ±‚é’©å­

**è“å›¾é’©å­çš„å®ç°**ï¼š
```python
@blueprint.before_request
def load_user():
    """è“å›¾çº§åˆ«çš„è¯·æ±‚å‰é’©å­"""
    if 'user_id' in session:
        g.user = User.get(session['user_id'])

@blueprint.after_request  
def add_cors_headers(response):
    """è“å›¾çº§åˆ«çš„è¯·æ±‚åé’©å­"""
    response.headers['Access-Control-Allow-Origin'] = '*'
    return response

@blueprint.teardown_request
def close_db_connection(exc):
    """è“å›¾çº§åˆ«çš„è¯·æ±‚æ¸…ç†é’©å­"""
    db = getattr(g, 'db_connection', None)
    if db is not None:
        db.close()
```

**é’©å­çš„æ³¨å†Œæœºåˆ¶**ï¼š
```python
def before_request(self, f: T_before_request) -> T_before_request:
    """æ³¨å†Œè“å›¾çº§åˆ«çš„è¯·æ±‚å‰é’©å­"""
    self.record(lambda s: s.app.before_request_funcs
               .setdefault(self.name, []).append(f))
    return f
```

#### 2. è“å›¾ä¸Šä¸‹æ–‡å¤„ç†å™¨

**æ¨¡æ¿ä¸Šä¸‹æ–‡çš„è“å›¾æ‰©å±•**ï¼š
```python
@blueprint.app_context_processor
def inject_blueprint_vars():
    """è“å›¾çº§åˆ«çš„ä¸Šä¸‹æ–‡å¤„ç†å™¨"""
    return {
        'blueprint_name': blueprint.name,
        'blueprint_static': lambda filename: url_for(f'{blueprint.name}.static', filename=filename)
    }

@blueprint.context_processor
def inject_user_permissions():
    """æ³¨å…¥ç”¨æˆ·æƒé™ä¿¡æ¯"""
    if hasattr(g, 'user'):
        return {
            'user_permissions': g.user.get_permissions(blueprint.name)
        }
    return {}
```

### è“å›¾çš„åµŒå¥—å’Œç»„ç»‡

#### 1. åµŒå¥—è“å›¾çš„å®ç°

**è“å›¾åµŒå¥—æ³¨å†Œ**ï¼š
```python
# çˆ¶è“å›¾
api_v1 = Blueprint('api_v1', __name__, url_prefix='/api/v1')

# å­åŠŸèƒ½è“å›¾
users_bp = Blueprint('users', __name__, url_prefix='/users')
posts_bp = Blueprint('posts', __name__, url_prefix='/posts')

@users_bp.route('/')
def list_users():
    return jsonify([])

@posts_bp.route('/')
def list_posts():
    return jsonify([])

# æ³¨å†Œåˆ°çˆ¶è“å›¾
api_v1.register_blueprint(users_bp)
api_v1.register_blueprint(posts_bp)

# æ³¨å†Œåˆ°åº”ç”¨
app.register_blueprint(api_v1)

# æœ€ç»ˆè·¯ç”±ï¼š
# /api/v1/users/ -> api_v1.users.list_users
# /api/v1/posts/ -> api_v1.posts.list_posts
```

#### 2. è“å›¾çš„æ¡ä»¶æ³¨å†Œ

**åŸºäºé…ç½®çš„è“å›¾å¯ç”¨**ï¼š
```python
def create_app(config=None):
    app = Flask(__name__)
    
    if config:
        app.config.from_object(config)
    
    # æ ¸å¿ƒè“å›¾å§‹ç»ˆæ³¨å†Œ
    from .main import main_bp
    app.register_blueprint(main_bp)
    
    # æ¡ä»¶æ€§æ³¨å†ŒåŠŸèƒ½è“å›¾
    if app.config.get('ENABLE_API', False):
        from .api import api_bp
        app.register_blueprint(api_bp, url_prefix='/api')
    
    if app.config.get('ENABLE_ADMIN', False):
        from .admin import admin_bp
        app.register_blueprint(admin_bp, url_prefix='/admin')
    
    return app
```

---

## ğŸ”„ è¯·æ±‚-å“åº”åŒ…è£…å™¨çš„æ‰©å±•è®¾è®¡

Flaské€šè¿‡ç»§æ‰¿Werkzeugçš„Requestå’ŒResponseç±»ï¼Œæ·»åŠ äº†æ¡†æ¶ç‰¹æœ‰çš„åŠŸèƒ½ã€‚

### Requestç±»çš„Flaskå®šåˆ¶

**Flaskç‰¹æœ‰çš„è¯·æ±‚å±æ€§** (`flask/wrappers.py:18-50`)ï¼š

```python
class Request(RequestBase):
    """Flaskçš„è¯·æ±‚å¯¹è±¡"""
    
    json_module: t.Any = json  # å¯æ’æ‹”çš„JSONæ¨¡å—
    
    # URLè§„åˆ™å’Œè§†å›¾å‚æ•°
    url_rule: Rule | None = None
    view_args: dict[str, t.Any] | None = None
    
    # è·¯ç”±å¼‚å¸¸
    routing_exception: HTTPException | None = None
    
    @property
    def max_content_length(self) -> int | None:
        """è¯·æ±‚å†…å®¹çš„æœ€å¤§é•¿åº¦ï¼Œæ”¯æŒè¿è¡Œæ—¶é…ç½®"""
        if self._max_content_length is not None:
            return self._max_content_length

        if not current_app:
            return super().max_content_length

        return current_app.config["MAX_CONTENT_LENGTH"]
    
    @max_content_length.setter
    def max_content_length(self, value: int | None) -> None:
        self._max_content_length = value
```

**è“å›¾æ„ŸçŸ¥çš„å±æ€§**ï¼š
```python
@property  
def endpoint(self) -> str | None:
    """åŒ¹é…çš„ç«¯ç‚¹åç§°"""
    if self.url_rule is not None:
        return self.url_rule.endpoint
    return None

@property
def blueprint(self) -> str | None:
    """åŒ¹é…çš„è“å›¾åç§°"""
    endpoint = self.endpoint
    if endpoint is not None and "." in endpoint:
        return endpoint.rpartition(".")[0]
    return None

@property
def blueprints(self) -> list[str]:
    """è“å›¾å±‚æ¬¡ç»“æ„åˆ—è¡¨"""
    name = self.blueprint
    if name is None:
        return []
    return _split_blueprint_path(name)
```

### JSONå¤„ç†çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥

**Requestçš„JSONæ–¹æ³•é›†æˆ**ï¼š
```python
@property
def json(self) -> t.Any:
    """è¯·æ±‚çš„JSONæ•°æ®"""
    return self.get_json()

def get_json(self, force: bool = False, silent: bool = False, cache: bool = True) -> t.Any:
    """è·å–JSONæ•°æ®ï¼Œé›†æˆFlaskçš„JSONæ¨¡å—"""
    if cache and hasattr(self, '_cached_json'):
        return self._cached_json[1]
        
    if not force and not self.is_json:
        return None
        
    data = self.get_data(cache=cache)
    
    try:
        rv = self.json_module.loads(data)
    except ValueError as e:
        if silent:
            rv = None
        else:
            rv = self.on_json_loading_failed(e)
    
    if cache:
        self._cached_json = (True, rv)
    
    return rv

def on_json_loading_failed(self, e: ValueError | None) -> t.Any:
    """JSONåŠ è½½å¤±è´¥çš„å¤„ç†ï¼Œè€ƒè™‘è°ƒè¯•æ¨¡å¼"""
    try:
        return super().on_json_loading_failed(e)
    except BadRequest as ebr:
        if current_app and current_app.debug:
            raise  # è°ƒè¯•æ¨¡å¼æ˜¾ç¤ºè¯¦ç»†é”™è¯¯
        raise BadRequest() from ebr  # ç”Ÿäº§æ¨¡å¼éšè—é”™è¯¯ç»†èŠ‚
```

### Responseç±»çš„Flaskå¢å¼º

**Responseçš„é»˜è®¤è¡Œä¸ºå®šåˆ¶**ï¼š
```python
class Response(ResponseBase):
    """Flaskçš„å“åº”å¯¹è±¡"""
    
    default_mimetype = 'text/html'  # Flaské»˜è®¤HTML
    json_module = json              # å¯æ’æ‹”JSONæ¨¡å—
    autocorrect_location_header = False  # ç¦ç”¨è‡ªåŠ¨ä½ç½®çº æ­£

    @property
    def max_cookie_size(self) -> int:
        """Cookieå¤§å°é™åˆ¶ï¼Œæ”¯æŒåº”ç”¨é…ç½®"""
        if current_app:
            return current_app.config["MAX_COOKIE_SIZE"]
        return super().max_cookie_size  # Werkzeugé»˜è®¤å€¼
```

---

## ğŸ› ï¸ å·¥å…·å‡½æ•°çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥è®¾è®¡

Flaskçš„å·¥å…·å‡½æ•°éƒ½å…·å¤‡ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›ï¼Œèƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹æ™ºèƒ½å·¥ä½œã€‚

### url_forçš„æ™ºèƒ½è¡Œä¸º

**ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„URLç”Ÿæˆ** (`flask/helpers.py:188-239`)ï¼š

```python
def url_for(endpoint: str, *, _anchor: str | None = None, 
           _method: str | None = None, _scheme: str | None = None,
           _external: bool | None = None, **values: t.Any) -> str:
    """ç”ŸæˆURLï¼Œå…·å¤‡ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›"""
    return current_app.url_for(
        endpoint,
        _anchor=_anchor,
        _method=_method,
        _scheme=_scheme,
        _external=_external,
        **values,
    )

# Flask.url_forçš„å®ç°
def url_for(self, endpoint: str, *, _anchor=None, _method=None, 
           _scheme=None, _external=None, **values):
    """åº”ç”¨çº§çš„URLç”Ÿæˆ"""
    reqctx = _cv_request.get(None)
    
    if reqctx is not None:
        url_adapter = reqctx.url_adapter
        blueprint_name = reqctx.request.blueprint
        
        # å¤„ç†ç›¸å¯¹ç«¯ç‚¹ï¼ˆä»¥.å¼€å¤´ï¼‰
        if endpoint.startswith('.'):
            if blueprint_name is not None:
                endpoint = f"{blueprint_name}{endpoint}"
            else:
                endpoint = endpoint[1:]
    else:
        url_adapter = _cv_app.get().url_adapter
        
    return url_adapter.build(
        endpoint, values, method=_method, 
        force_external=_external, append_unknown=False
    )
```

### redirectå’Œabortçš„åº”ç”¨æ„ŸçŸ¥

**åº”ç”¨è‡ªå®šä¹‰çš„redirectè¡Œä¸º**ï¼š
```python
def redirect(location: str, code: int = 302, Response: type[BaseResponse] | None = None) -> BaseResponse:
    """åˆ›å»ºé‡å®šå‘å“åº”ï¼Œæ”¯æŒåº”ç”¨è‡ªå®šä¹‰"""
    if current_app:
        return current_app.redirect(location, code=code)
    return _wz_redirect(location, code=code, Response=Response)

def abort(code: int | BaseResponse, *args: t.Any, **kwargs: t.Any) -> t.NoReturn:
    """æŠ›å‡ºHTTPå¼‚å¸¸ï¼Œæ”¯æŒåº”ç”¨è‡ªå®šä¹‰aborter"""
    if current_app:
        current_app.aborter(code, *args, **kwargs)
    _wz_abort(code, *args, **kwargs)
```

### stream_with_contextçš„ä¸Šä¸‹æ–‡ä¿æŒ

**æµå¼å“åº”çš„ä¸Šä¸‹æ–‡ä¼ é€’**ï¼š
```python
def stream_with_context(generator_or_function):
    """åœ¨æµå¼å“åº”ä¸­ä¿æŒè¯·æ±‚ä¸Šä¸‹æ–‡"""
    try:
        gen = iter(generator_or_function)
    except TypeError:
        # å¦‚æœæ˜¯å‡½æ•°ï¼ŒåŒ…è£…æˆè£…é¥°å™¨
        def decorator(*args, **kwargs):
            gen = generator_or_function(*args, **kwargs)
            return stream_with_context(gen)
        return update_wrapper(decorator, generator_or_function)

    def generator():
        ctx = _cv_request.get(None)
        if ctx is None:
            raise RuntimeError(
                "'stream_with_context' can only be used when a request context is active"
            )
        
        with ctx:
            # è™šæ‹Ÿå“¨å…µï¼Œç¡®ä¿ä¸Šä¸‹æ–‡åœ¨ç”Ÿæˆå™¨å†…éƒ¨
            yield None
            
            try:
                yield from gen
            finally:
                if hasattr(gen, "close"):
                    gen.close()

    # å¯åŠ¨ç”Ÿæˆå™¨å¹¶ä¸¢å¼ƒå“¨å…µå€¼
    wrapped_g = generator()
    next(wrapped_g)
    return wrapped_g
```

---

## ğŸ“¦ JSONå¤„ç†çš„å¯æ’æ‹”è®¾è®¡

Flaskçš„JSONç³»ç»Ÿé‡‡ç”¨provideræ¨¡å¼ï¼Œæ”¯æŒå®Œå…¨è‡ªå®šä¹‰çš„JSONå¤„ç†ã€‚

### JSONProviderçš„æŠ½è±¡æ¥å£

**JSONæä¾›è€…åŸºç±»**ï¼š
```python
class JSONProvider:
    """JSONåºåˆ—åŒ–æä¾›è€…çš„åŸºç±»"""
    
    def dumps(self, obj: t.Any, **kwargs: t.Any) -> str:
        """åºåˆ—åŒ–å¯¹è±¡ä¸ºJSONå­—ç¬¦ä¸²"""
        raise NotImplementedError
        
    def loads(self, s: str | bytes) -> t.Any:
        """ååºåˆ—åŒ–JSONå­—ç¬¦ä¸²ä¸ºå¯¹è±¡"""
        raise NotImplementedError
        
    def response(self, obj: t.Any) -> Response:
        """åˆ›å»ºJSONå“åº”"""
        return current_app.response_class(
            self.dumps(obj), mimetype="application/json"
        )
```

### DefaultJSONProviderçš„å®ç°

**é»˜è®¤JSONæä¾›è€…**ï¼š
```python
class DefaultJSONProvider(JSONProvider):
    """é»˜è®¤çš„JSONæä¾›è€…å®ç°"""
    
    def __init__(self, app: Flask) -> None:
        self.app = app
    
    def dumps(self, obj: t.Any, **kwargs: t.Any) -> str:
        kwargs.setdefault("default", _default)
        kwargs.setdefault("ensure_ascii", self.ensure_ascii)
        kwargs.setdefault("sort_keys", self.sort_keys)
        
        if current_app:
            kwargs.setdefault("indent", current_app.json.compact and None or 2)
        
        return json.dumps(obj, **kwargs)
        
    def loads(self, s: str | bytes) -> t.Any:
        return json.loads(s)
    
    def response(self, obj: t.Any) -> Response:
        """åˆ›å»ºJSONå“åº”ï¼Œæ”¯æŒè°ƒè¯•æ ¼å¼åŒ–"""
        json_str = self.dumps(obj)
        return current_app.response_class(
            json_str, 
            mimetype=self.mimetype,
            headers={"Content-Length": len(json_str.encode())}
        )
```

### è‡ªå®šä¹‰JSONæä¾›è€…ç¤ºä¾‹

**æ‰©å±•JSONç±»å‹æ”¯æŒ**ï¼š
```python
import decimal
import uuid
from datetime import datetime

class ExtendedJSONProvider(DefaultJSONProvider):
    """æ”¯æŒæ›´å¤šPythonç±»å‹çš„JSONæä¾›è€…"""
    
    def default(self, obj):
        """å¤„ç†é¢å¤–çš„Pythonç±»å‹"""
        if isinstance(obj, decimal.Decimal):
            return float(obj)
        elif isinstance(obj, uuid.UUID):
            return str(obj)
        elif isinstance(obj, datetime):
            return obj.isoformat()
        elif hasattr(obj, '__dict__'):
            return obj.__dict__
        
        return super().default(obj)
    
    def dumps(self, obj, **kwargs):
        kwargs.setdefault('default', self.default)
        return super().dumps(obj, **kwargs)

# ä½¿ç”¨è‡ªå®šä¹‰provider
app.json = ExtendedJSONProvider(app)
```

### å¯å€Ÿé‰´çš„è®¾è®¡æ¨¡å¼

#### è“å›¾ç³»ç»Ÿæ–¹é¢
1. **å»¶è¿Ÿç»‘å®šæ¨¡å¼**: recordæœºåˆ¶å®ç°é…ç½®çš„å»¶è¿Ÿæ‰§è¡Œ
2. **çŠ¶æ€å°è£…æ¨¡å¼**: BlueprintSetupStateç®¡ç†æ³¨å†Œæ—¶çŠ¶æ€
3. **å‘½åç©ºé—´éš”ç¦»**: è‡ªåŠ¨çš„ç«¯ç‚¹ã€æ¨¡æ¿ã€é™æ€æ–‡ä»¶éš”ç¦»
4. **å±‚æ¬¡åŒ–ç»„ç»‡**: æ”¯æŒè“å›¾åµŒå¥—çš„æ¸…æ™°æ¶æ„

#### æ‰©å±•æ€§è®¾è®¡æ–¹é¢
1. **å¯æ’æ‹”æ¥å£**: JSONProviderç­‰æŠ½è±¡æ¥å£è®¾è®¡
2. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: å·¥å…·å‡½æ•°çš„æ™ºèƒ½ç¯å¢ƒé€‚åº”
3. **å‘åå…¼å®¹**: æ‰©å±•åŠŸèƒ½ä¸ç ´åç°æœ‰API
4. **æ¸è¿›å¼å¤æ‚åº¦**: ç®€å•ä½¿ç”¨åˆ°é«˜çº§å®šåˆ¶çš„å¹³æ»‘è¿‡æ¸¡

#### åŒ…è£…å™¨è®¾è®¡æ–¹é¢
1. **ç»§æ‰¿æ‰©å±•æ¨¡å¼**: åŸºäºWerkzeugçš„å¢é‡å¢å¼º
2. **å±æ€§ä»£ç†æ¨¡å¼**: åŠ¨æ€è®¡ç®—çš„é…ç½®å±æ€§
3. **é”™è¯¯å¤„ç†åˆ†å±‚**: è°ƒè¯•æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼çš„å·®å¼‚åŒ–å¤„ç†
4. **æ¨¡å—åŒ–é›†æˆ**: JSONç­‰åŠŸèƒ½çš„å¯æ’æ‹”è®¾è®¡

### è®¾è®¡å“²å­¦æ€»ç»“

Flaskçš„Blueprintå’Œæ‰©å±•æ€§ç³»ç»Ÿä½“ç°äº†ä»¥ä¸‹è®¾è®¡æ™ºæ…§ï¼š

1. **æ¨¡å—åŒ–ä¼˜å…ˆ**: é€šè¿‡è“å›¾å®ç°æ¸…æ™°çš„ä»£ç ç»„ç»‡
2. **å»¶è¿Ÿç»‘å®š**: æ”¯æŒçµæ´»çš„é…ç½®å’ŒåŠ¨æ€ç»„è£…
3. **æ¸è¿›å¼æ¶æ„**: ä»ç®€å•åº”ç”¨åˆ°å¤æ‚ç³»ç»Ÿçš„å¹³æ»‘æ‰©å±•
4. **æ’ä»¶å‹å¥½**: ä¸°å¯Œçš„æ‰©å±•ç‚¹å’Œé’©å­æœºåˆ¶
5. **å‘åå…¼å®¹**: åŠŸèƒ½å¢å¼ºä¸ç ´åç°æœ‰ä»£ç 
6. **é…ç½®çµæ´»**: æ”¯æŒè¿è¡Œæ—¶é…ç½®å’Œç¯å¢ƒé€‚åº”

è¿™äº›è®¾è®¡æ¨¡å¼ä¸ä»…é€‚ç”¨äºWebæ¡†æ¶ï¼Œåœ¨ä»»ä½•éœ€è¦æ¨¡å—åŒ–ã€å¯æ‰©å±•æ¶æ„çš„ç³»ç»Ÿè®¾è®¡ä¸­éƒ½å…·æœ‰é‡è¦çš„å‚è€ƒä»·å€¼ã€‚é€šè¿‡å­¦ä¹ Flaskçš„è¿™äº›è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•çš„è½¯ä»¶ç³»ç»Ÿã€‚